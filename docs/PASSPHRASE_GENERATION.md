# Passphrase Generation — GM-Toolkit

## Purpose
GM-Toolkit uses **thematic passphrases** to help the GM match an item’s **unidentified** and **identified** card variants at the table.

A passphrase is:
- generated by default (editable)
- clearly visible on both card variants
- stable once assigned (unless regenerated/edited)

This document defines how passphrases are generated, formatted, stored, and de-duplicated.

---

## Core rules

### 1) One passphrase per item (shared across variants)
Each Item has a single passphrase value:
- Unidentified card: shows passphrase + vague description
- Identified card: shows the same passphrase + full details

### 2) Passphrase stability
- Once an item is created, its passphrase **must not change automatically**.
- The user may:
  - edit the passphrase manually
  - regenerate (new thematic passphrase)

### 3) Uniqueness (per campaign)
Passphrases should be unique **within a campaign** to avoid confusion at the table.

If a collision occurs:
1. Try generating a new passphrase up to N attempts (default N=10)
2. If still colliding, append a short suffix (e.g., `-II`, `-III`) or a 2–3 char code
3. Never silently overwrite an existing item’s passphrase

> Note: uniqueness per campaign keeps it simple and avoids cross-campaign constraints.

---

## Generation format

### Default format
Generate passphrases as **2–3 word phrases**:
- Pattern A (2-word): `adjective + noun`
- Pattern B (3-word): `adjective + noun + qualifier`

Examples:
- “ashen key”
- “gilded sigil”
- “moonlit oath”
- “hollow lantern”
- “iron covenant”
- “winter ink”

### Formatting for display
- Stored value: lowercase words separated by spaces (e.g., `ashen key`)
- Display:
  - on cards: render as a **badge** or **stamp**
  - optional uppercase styling for readability (visual only; stored value remains lowercase)

### Length guardrails
To keep cards readable:
- Target length: 8–20 characters (2-word) or 12–28 characters (3-word)
- If generated phrase exceeds limit, regenerate.

---

## Word lists

### Thematic vocabulary (recommended buckets)
Maintain word lists as plain arrays in code (no external dependency), for example:

**Adjectives**
- ashen, verdant, gilded, hollow, veiled, duskbound, frostbitten, radiant, grave, silent

**Nouns**
- key, sigil, oath, lantern, crown, blade, covenant, ember, relic, mirror

**Qualifiers (optional)**
- of dusk, of ash, of winter, of glass, of storms, of iron

### Content safety
- Avoid profanity and slurs (exclude from word lists).
- Keep phrases PG by construction.

---

## Regeneration behavior (UX)

### When generated
A passphrase is generated:
- when creating a new item (default)
- when the user clicks “Regenerate” on an item

### User controls
Item editor should provide:
- passphrase field (editable)
- “Regenerate” button
- “Copy” button (optional, helpful at table)

### Collision UX
If regeneration collides:
- show a friendly message:
  - “That passphrase is already used in this campaign. Generating another…”
- if fallback suffix is applied:
  - “Passphrase adjusted to avoid duplicates: ‘ashen key II’”

---

## Storage and export
- Passphrase is stored on the Item entity (single field).
- Export/import must preserve passphrases exactly.
- Merge/conflict logic:
  - If “most recent wins” is chosen, the passphrase from the most recently updated item wins.
  - If duplicated with new ID, the duplicate keeps its passphrase unless it collides, in which case the collision rules apply.

---

## Implementation notes (non-binding)
- Prefer deterministic casing: store passphrases normalized to lowercase.
- Keep generation purely local (no network calls).
- Consider seeding randomness per campaign for “vibe consistency” (optional later).
